data "aws_security_group" "opentest" {
    vpc_id = "${data.aws_vpc.network.id}"

    tags {
        Name = "${var.opentest_gw_sg}"
    }
}

resource "aws_security_group_rule" "allow_https_from_test_vpcs" {
    type = "ingress"

    from_port = 443
    to_port = 443
    protocol = "tcp"
    cidr_blocks = ["10.2.0.0/16", "10.3.0.0/16"]

    security_group_id = "${data.aws_security_group.opentest.id}"
}

resource "aws_security_group_rule" "allow_ssl_from_test_vpcs" {
    type = "ingress"

    from_port = 389
    to_port = 389
    protocol = "tcp"
    cidr_blocks = ["10.2.0.0/16", "10.3.0.0/16"]

    security_group_id = "${data.aws_security_group.opentest.id}"
}